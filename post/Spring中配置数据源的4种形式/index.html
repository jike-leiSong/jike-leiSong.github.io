<!DOCTYPE html>
<html>
  <head>
      
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>itme.ink</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="description" content="温故而知新"/>
<meta name="keywords" content="温故而知新"/>

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" href="https://jike-leisong.github.io//favicon.ico">

<link rel="stylesheet" href="https://jike-leisong.github.io//styles/main.css">

<!-- Modernizr JS -->
<script src="https://jike-leisong.github.io//media/scripts/_vendors/modernizr-2.6.2.min.js"></script>
<!-- FOR IE9 below -->
<!--[if lt IE 9]>
<scripts src="https://jike-leisong.github.io//media/scripts/_vendors/respond.min.js"></scripts>
<![endif]-->

<!-- Comment -->


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/tomorrow-night.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<link crossorigin="anonymous" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" href="https://lib.baomitu.com/font-awesome/5.8.1/css/all.min.css" rel="stylesheet">

  </head>
  <body>
  
<div id="fh5co-offcanvas">
    <a href="#!" class="fh5co-close-offcanvas js-fh5co-close-offcanvas">
        <span><i class="icon-cross3"></i> <span>Close</span></span>
    </a>
    <div class="fh5co-bio">
        <figure>
            <img src="https://jike-leisong.github.io//media/images/avatar.png" alt="itme.ink" class="img-responsive">
        </figure>
        <h3 class="heading">ABOUT ME</h3>
        <h2>itme.ink</h2>
        <p>温故而知新</p>
        <ul class="fh5co-social">
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
                <li>
                    
                </li>
            
        </ul>
    </div>

    <div class="fh5co-menu">
        <div class="fh5co-box">
            <h3 class="heading">搜索</h3>
            <form action="#">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="输入关键字">
                </div>
            </form>
        </div>
        <div class="fh5co-box">
            <h3 class="heading">标签</h3>
            <ul>
                
                    <li><a href="https://jike-leisong.github.io//tag/ZMreOtewG">MVC</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/2RK0lyPtw">DB</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/hJqNul-if">Spring Cloud</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/mian-shi-ti">面试题</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/yYzItG4Us">设计模式</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/2VvjfMCS1">源码分析</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/duo-xian-cheng">多线程</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/xiao-xi">消息</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/0WBzoU1G-">Mybatis</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/sOMy5ZlVw">分布式</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/tool">Tool</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/suan-fa">算法</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/tomact">Tomact</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/linux">Linux</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/MzKEL8HsE">Spring</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/boot">Boot</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/JUSmlN723">Git</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/netty">Netty</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/kua-yu">跨域</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/xing-neng-diao-you">性能调优</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/java">Java</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/redis">Redis</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/shu-ju-ku">数据库</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/lei-jia-zai">类加载</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/jia-gou">架构</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/soa">SOA</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/zookeeper">Zookeeper</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/shu-ju-yuan">数据源</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/fen-bu-shi-shi-wu">分布式事务</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/sql">SQL</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/mabatis">Mabatis</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/hashmap">HashMap</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/cloud">Cloud</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/huan-cun">缓存</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/session">Session</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/cron">Cron</a></li>
                
                    <li><a href="https://jike-leisong.github.io//tag/mi-deng-xing">幂等性</a></li>
                
            </ul>
        </div>
    </div>
</div>

<header id="fh5co-header">
    <div class="container-fluid">
        <div class="row">
            <a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
            <ul class="fh5co-social">
                
                    <li>
                        <a href="/"
                         >
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives"
                         >
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags"
                         >
                            标签
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/about"
                         >
                            关于
                        </a>
                    </li>
                
            </ul>
            <div class="col-lg-12 col-md-12 text-center">
                <h1 id="fh5co-logo">
                    <a href="https://jike-leisong.github.io/">itme.ink</a>
                </h1>
            </div>
        </div>
    </div>
</header>


<!--  <a href="#" class="fh5co-post-prev"><span>👈 Prev</span></a>-->
<!--  <a href="#" class="fh5co-post-next"><span>Next 👉</span></a>-->

  <div class="container-fluid">
      <div class="row fh5co-post-entry single-entry">
          <article class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12 col-xs-offset-0">
              <figure class="animate-box">
                  
              </figure>
              <span class="fh5co-meta animate-box">
                  
                      <div class="tag-container">
                          
                              <a href="https://jike-leisong.github.io//tag/shu-ju-yuan" class="tag">数据源, </a>
                          
                              <a href="https://jike-leisong.github.io//tag/mian-shi-ti" class="tag">面试题, </a>
                          
                      </div>
                  
              </span>
              <h2 class="fh5co-article-title animate-box">Spring中配置数据源的4种形式</h2>
              <span class="fh5co-meta fh5co-date animate-box">2017-12-17</span>

              <div class="col-lg-12 col-lg-offset-0 col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-left content-article">
                  <div class="row">
                      <div class="col-md-12 animate-box post-content">
                          <p> <p>不管采用何种持久化技术，都需要定义数据源。Spring中提供了4种不同形式的数据源配置方式：
spring自带的数据源(DriverManagerDataSource)，DBCP数据源，C3P0数据源,JNDI数据源。</p>
<p><strong>1.spring自带的数据源</strong></p>
<p>DriverManagerDataSource
XML代码：</p>
<pre><code class="language-xml">&lt;bean id=&quot;dataSource&quot;     
      class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;     
    &lt;property name=&quot;driverClassName&quot; value=&quot;oracle.jdbc.driver.OracleDriver&quot; /&gt;  
    &lt;property name=&quot;url&quot; value=&quot;jdbc:oracle:thin:@172.19.34.6:1521:ORCL&quot; /&gt;  
    &lt;property name=&quot;username&quot; value=&quot;orclight&quot; /&gt;     
    &lt;property name=&quot;password&quot; value=&quot;123456&quot; /&gt;  
&lt;/bean&gt;  
</code></pre>
<p><strong>2.DBCP数据源</strong></p>
<p>DBCP的配置依赖于2个jar包commons-dbcp.jar，commons-pool.jar。
XML代码:</p>
<pre><code class="language-xml">&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;         
        destroy-method=&quot;close&quot;&gt;         
    &lt;property name=&quot;driverClassName&quot; value=&quot;oracle.jdbc.driver.OracleDriver&quot; /&gt;  
    &lt;property name=&quot;url&quot; value=&quot;jdbc:oracle:thin:@172.19.34.6:1521:ORCL&quot; /&gt;  
    &lt;property name=&quot;username&quot; value=&quot;orclight&quot; /&gt;     
    &lt;property name=&quot;password&quot; value=&quot;123456&quot; /&gt;        
&lt;/bean&gt;   
</code></pre>
<p>上面代码的解释：
BasicDataSource提供了close()方法关闭数据源，所以必须设定destroy-method=”close”属性， 以便Spring容器关闭时，数据源能够正常关闭。除以上必须的数据源属性外，还有一些常用的属性：</p>
<blockquote>
<p>defaultAutoCommit：设置从数据源中返回的连接是否采用自动提交机制，默认值为 true；
defaultReadOnly：设置数据源是否仅能执行只读操作， 默认值为 false；
maxActive：最大连接数据库连接数，设置为0时，表示没有限制；
maxIdle：最大等待连接中的数量，设置为0时，表示没有限制；
maxWait：最大等待秒数，单位为毫秒， 超过时间会报出错误信息；
validationQuery：用于验证连接是否成功的查询SQL语句，SQL语句必须至少要返回一行数据， 如你可以简单地设置为：“select count(*) from user”；
removeAbandoned：是否自我中断，默认是 false ；
removeAbandonedTimeout：几秒后数据连接会自动断开，在removeAbandoned为true，提供该值；
logAbandoned：是否记录中断事件， 默认为 false；</p>
</blockquote>
<p><strong>3.C3P0数据源</strong></p>
<p>C3P0是一个开放源代码的JDBC数据源实现项目，C3P0依赖于jar包c3p0.jar。
XML代码：</p>
<pre><code class="language-xml">&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;         
            destroy-method=&quot;close&quot;&gt;        
        &lt;property name=&quot;driverClass&quot; value=&quot; oracle.jdbc.driver.OracleDriver &quot;/&gt;        
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:oracle:thin:@172.19.34.6:1521:ORCL&quot;/&gt;        
        &lt;property name=&quot;user&quot; value=&quot;orclight&quot;/&gt;        
        &lt;property name=&quot;password&quot; value=&quot;123456&quot;/&gt;        
    &lt;/bean&gt;
</code></pre>
<p>ComboPooledDataSource和BasicDataSource一样提供了一个用于关闭数据源的close()方法，这样我们就可以保证Spring容器关闭时数据源能够成功释放。
C3P0拥有比DBCP更丰富的配置属性，通过这些属性，可以对数据源进行各种有效的控制：</p>
<blockquote>
<p>acquireIncrement：当连接池中的连接用完时，C3P0一次性创建新连接的数目；
acquireRetryAttempts：定义在从数据库获取新连接失败后重复尝试获取的次数，默认为30；
acquireRetryDelay：两次连接中间隔时间，单位毫秒，默认为1000；
autoCommitOnClose：连接关闭时默认将所有未提交的操作回滚。默认为false；
automaticTestTable： C3P0将建一张名为Test的空表，并使用其自带的查询语句进行测试。如果定义了这个参数，那么属性preferredTestQuery将被忽略。你 不能在这张Test表上进行任何操作，它将中为C3P0测试所用，默认为null；
breakAfterAcquireFailure：获取连接失败将会引起所有等待获取连接的线程抛出异常。但是数据源仍有效保留，并在下次调   用getConnection()的时候继续尝试获取连接。如果设为true，那么在尝试获取连接失败后该数据源将申明已断开并永久关闭。默认为 false；
checkoutTimeout：当连接池用完时客户端调用getConnection()后等待获取新连接的时间，超时后将抛出SQLException，如设为0则无限期等待。单位毫秒，默认为0；
connectionTesterClassName： 通过实现ConnectionTester或QueryConnectionTester的类来测试连接，类名需设置为全限定名。默认为 com.mchange.v2.C3P0.impl.DefaultConnectionTester；
idleConnectionTestPeriod：隔多少秒检查所有连接池中的空闲连接，默认为0表示不检查；
initialPoolSize：初始化时创建的连接数，应在minPoolSize与maxPoolSize之间取值。默认为3；
maxIdleTime：最大空闲时间，超过空闲时间的连接将被丢弃。为0或负数则永不丢弃。默认为0；
maxPoolSize：连接池中保留的最大连接数。默认为15；
maxStatements：JDBC的标准参数，用以控制数据源内加载的PreparedStatement数量。但由于预缓存的Statement属 于单个Connection而不是整个连接池。所以设置这个参数需要考虑到多方面的因素，如果maxStatements与 maxStatementsPerConnection均为0，则缓存被关闭。默认为0；
maxStatementsPerConnection：连接池内单个连接所拥有的最大缓存Statement数。默认为0；
numHelperThreads：C3P0是异步操作的，缓慢的JDBC操作通过帮助进程完成。扩展这些操作可以有效的提升性能，通过多线程实现多个操作同时被执行。默认为3；
preferredTestQuery：定义所有连接测试都执行的测试语句。在使用连接测试的情况下这个参数能显著提高测试速度。测试的表必须在初始数据源的时候就存在。默认为null；
propertyCycle： 用户修改系统配置参数执行前最多等待的秒数。默认为300；
testConnectionOnCheckout：因性能消耗大请只在需要的时候使用它。如果设为true那么在每个connection提交的时候都 将校验其有效性。建议使用idleConnectionTestPeriod或automaticTestTable
等方法来提升连接测试的性能。默认为false；
testConnectionOnCheckin：如果设为true那么在取得连接的同时将校验连接的有效性。默认为false。</p>
</blockquote>
<p><strong>4.JNDI数据源</strong></p>
<p>如果应用配置在高性能的应用服务器（如WebLogic或Websphere,tomcat等）上，我们可能更希望使用应用服务器本身提供的数据源。应用服务器的数据源 使用JNDI开放调用者使用，Spring为此专门提供引用JNDI资源的JndiObjectFactoryBean类。
xml 代码：</p>
<pre><code class="language-xml">&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jndi.JndiObjectFactoryBean&quot;&gt;        
        &lt;property name=&quot;jndiName&quot; value=&quot;java:comp/env/jdbc/orclight&quot;/&gt;        
&lt;/bean&gt; 
</code></pre>
<pre><code class="language-xml">&lt;beans xmlns=http://www.springframework.org/schema/beans      
xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance      
xmlns:jee=http://www.springframework.org/schema/jee      
xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans       
http://www.springframework.org/schema/beans/spring-beans-2.0.xsd       
http://www.springframework.org/schema/jee      
http://www.springframework.org/schema/jee/spring-jee-2.0.xsd&quot;&gt;        
    &lt;jee:jndi-lookup id=&quot;dataSource&quot; jndi-name=&quot; java:comp/env/jdbc/orclight&quot;/&gt;        
&lt;/beans&gt; 
</code></pre>
 </p>
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                              <div class="next-post">
                                  <div class="next">下一篇</div>
                                  <a href="https://jike-leisong.github.io//post/深入理解分布式事务,高并发下分布式事务的解决方案">
                                      <h3 class="post-title">
                                          深入理解分布式事务,高并发下分布式事务的解决方案
                                      </h3>
                                  </a>
                              </div>
                          
                      </div>
                  </div>

                  <div class="row">
                      <div class="col-md-12 animate-box">
                          
                      </div>
                  </div>
              </div>

          </article>
      </div>
  </div>

    
<footer id="fh5co-footer">
  <p>Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a></p>
</footer>


    
<!-- jQuery -->
<script src="https://jike-leisong.github.io//media/scripts/_vendors/jquery.min.js"></script>
<!-- jQuery Easing -->
<script src="https://jike-leisong.github.io//media/scripts/_vendors/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="https://jike-leisong.github.io//media/scripts/_vendors/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="https://jike-leisong.github.io//media/scripts/_vendors/jquery.waypoints.min.js"></script>
<!-- Main JS -->
<script src="https://jike-leisong.github.io//media/scripts/_vendors/main.js"></script>
<!-- Md5 Min JS -->
<script src="https://jike-leisong.github.io//media/scripts/_vendors/md5.min.js"></script>

<script type="application/javascript">
    hljs.initHighlightingOnLoad();
</script>




  </body>
</html>
