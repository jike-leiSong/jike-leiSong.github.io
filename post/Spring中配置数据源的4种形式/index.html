<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Spring中配置数据源的4种形式 | itme.ink</title>
<meta name="description" content="温故而知新">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://jike-leisong.github.io//favicon.ico?v=1573183571074">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://jike-leisong.github.io//styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://jike-leisong.github.io/">
        <img src="https://jike-leisong.github.io//images/avatar.png?v=1573183571074" class="site-logo">
        <h1 class="site-title">itme.ink</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      温故而知新
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://jike-leisong.github.io//atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Spring中配置数据源的4种形式</h2>
            <div class="post-date">2017-12-17</div>
            
            <div class="post-content">
              <p>不管采用何种持久化技术，都需要定义数据源。Spring中提供了4种不同形式的数据源配置方式：<br>
spring自带的数据源(DriverManagerDataSource)，DBCP数据源，C3P0数据源,JNDI数据源。</p>
<p><strong>1.spring自带的数据源</strong></p>
<p>DriverManagerDataSource<br>
XML代码：</p>
<pre><code class="language-xml">&lt;bean id=&quot;dataSource&quot;     
      class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;     
    &lt;property name=&quot;driverClassName&quot; value=&quot;oracle.jdbc.driver.OracleDriver&quot; /&gt;  
    &lt;property name=&quot;url&quot; value=&quot;jdbc:oracle:thin:@172.19.34.6:1521:ORCL&quot; /&gt;  
    &lt;property name=&quot;username&quot; value=&quot;orclight&quot; /&gt;     
    &lt;property name=&quot;password&quot; value=&quot;123456&quot; /&gt;  
&lt;/bean&gt;  
</code></pre>
<p><strong>2.DBCP数据源</strong></p>
<p>DBCP的配置依赖于2个jar包commons-dbcp.jar，commons-pool.jar。<br>
XML代码:</p>
<pre><code class="language-xml">&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;         
        destroy-method=&quot;close&quot;&gt;         
    &lt;property name=&quot;driverClassName&quot; value=&quot;oracle.jdbc.driver.OracleDriver&quot; /&gt;  
    &lt;property name=&quot;url&quot; value=&quot;jdbc:oracle:thin:@172.19.34.6:1521:ORCL&quot; /&gt;  
    &lt;property name=&quot;username&quot; value=&quot;orclight&quot; /&gt;     
    &lt;property name=&quot;password&quot; value=&quot;123456&quot; /&gt;        
&lt;/bean&gt;   
</code></pre>
<p>上面代码的解释：<br>
BasicDataSource提供了close()方法关闭数据源，所以必须设定destroy-method=”close”属性， 以便Spring容器关闭时，数据源能够正常关闭。除以上必须的数据源属性外，还有一些常用的属性：</p>
<blockquote>
<p>defaultAutoCommit：设置从数据源中返回的连接是否采用自动提交机制，默认值为 true；<br>
defaultReadOnly：设置数据源是否仅能执行只读操作， 默认值为 false；<br>
maxActive：最大连接数据库连接数，设置为0时，表示没有限制；<br>
maxIdle：最大等待连接中的数量，设置为0时，表示没有限制；<br>
maxWait：最大等待秒数，单位为毫秒， 超过时间会报出错误信息；<br>
validationQuery：用于验证连接是否成功的查询SQL语句，SQL语句必须至少要返回一行数据， 如你可以简单地设置为：“select count(*) from user”；<br>
removeAbandoned：是否自我中断，默认是 false ；<br>
removeAbandonedTimeout：几秒后数据连接会自动断开，在removeAbandoned为true，提供该值；<br>
logAbandoned：是否记录中断事件， 默认为 false；</p>
</blockquote>
<p><strong>3.C3P0数据源</strong></p>
<p>C3P0是一个开放源代码的JDBC数据源实现项目，C3P0依赖于jar包c3p0.jar。<br>
XML代码：</p>
<pre><code class="language-xml">&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;         
            destroy-method=&quot;close&quot;&gt;        
        &lt;property name=&quot;driverClass&quot; value=&quot; oracle.jdbc.driver.OracleDriver &quot;/&gt;        
        &lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:oracle:thin:@172.19.34.6:1521:ORCL&quot;/&gt;        
        &lt;property name=&quot;user&quot; value=&quot;orclight&quot;/&gt;        
        &lt;property name=&quot;password&quot; value=&quot;123456&quot;/&gt;        
    &lt;/bean&gt;
</code></pre>
<p>ComboPooledDataSource和BasicDataSource一样提供了一个用于关闭数据源的close()方法，这样我们就可以保证Spring容器关闭时数据源能够成功释放。<br>
C3P0拥有比DBCP更丰富的配置属性，通过这些属性，可以对数据源进行各种有效的控制：</p>
<blockquote>
<p>acquireIncrement：当连接池中的连接用完时，C3P0一次性创建新连接的数目；<br>
acquireRetryAttempts：定义在从数据库获取新连接失败后重复尝试获取的次数，默认为30；<br>
acquireRetryDelay：两次连接中间隔时间，单位毫秒，默认为1000；<br>
autoCommitOnClose：连接关闭时默认将所有未提交的操作回滚。默认为false；<br>
automaticTestTable： C3P0将建一张名为Test的空表，并使用其自带的查询语句进行测试。如果定义了这个参数，那么属性preferredTestQuery将被忽略。你 不能在这张Test表上进行任何操作，它将中为C3P0测试所用，默认为null；<br>
breakAfterAcquireFailure：获取连接失败将会引起所有等待获取连接的线程抛出异常。但是数据源仍有效保留，并在下次调   用getConnection()的时候继续尝试获取连接。如果设为true，那么在尝试获取连接失败后该数据源将申明已断开并永久关闭。默认为 false；<br>
checkoutTimeout：当连接池用完时客户端调用getConnection()后等待获取新连接的时间，超时后将抛出SQLException，如设为0则无限期等待。单位毫秒，默认为0；<br>
connectionTesterClassName： 通过实现ConnectionTester或QueryConnectionTester的类来测试连接，类名需设置为全限定名。默认为 com.mchange.v2.C3P0.impl.DefaultConnectionTester；<br>
idleConnectionTestPeriod：隔多少秒检查所有连接池中的空闲连接，默认为0表示不检查；<br>
initialPoolSize：初始化时创建的连接数，应在minPoolSize与maxPoolSize之间取值。默认为3；<br>
maxIdleTime：最大空闲时间，超过空闲时间的连接将被丢弃。为0或负数则永不丢弃。默认为0；<br>
maxPoolSize：连接池中保留的最大连接数。默认为15；<br>
maxStatements：JDBC的标准参数，用以控制数据源内加载的PreparedStatement数量。但由于预缓存的Statement属 于单个Connection而不是整个连接池。所以设置这个参数需要考虑到多方面的因素，如果maxStatements与 maxStatementsPerConnection均为0，则缓存被关闭。默认为0；<br>
maxStatementsPerConnection：连接池内单个连接所拥有的最大缓存Statement数。默认为0；<br>
numHelperThreads：C3P0是异步操作的，缓慢的JDBC操作通过帮助进程完成。扩展这些操作可以有效的提升性能，通过多线程实现多个操作同时被执行。默认为3；<br>
preferredTestQuery：定义所有连接测试都执行的测试语句。在使用连接测试的情况下这个参数能显著提高测试速度。测试的表必须在初始数据源的时候就存在。默认为null；<br>
propertyCycle： 用户修改系统配置参数执行前最多等待的秒数。默认为300；<br>
testConnectionOnCheckout：因性能消耗大请只在需要的时候使用它。如果设为true那么在每个connection提交的时候都 将校验其有效性。建议使用idleConnectionTestPeriod或automaticTestTable<br>
等方法来提升连接测试的性能。默认为false；<br>
testConnectionOnCheckin：如果设为true那么在取得连接的同时将校验连接的有效性。默认为false。</p>
</blockquote>
<p><strong>4.JNDI数据源</strong></p>
<p>如果应用配置在高性能的应用服务器（如WebLogic或Websphere,tomcat等）上，我们可能更希望使用应用服务器本身提供的数据源。应用服务器的数据源 使用JNDI开放调用者使用，Spring为此专门提供引用JNDI资源的JndiObjectFactoryBean类。<br>
xml 代码：</p>
<pre><code class="language-xml">&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jndi.JndiObjectFactoryBean&quot;&gt;        
        &lt;property name=&quot;jndiName&quot; value=&quot;java:comp/env/jdbc/orclight&quot;/&gt;        
&lt;/bean&gt; 
</code></pre>
<pre><code class="language-xml">&lt;beans xmlns=http://www.springframework.org/schema/beans      
xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance      
xmlns:jee=http://www.springframework.org/schema/jee      
xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans       
http://www.springframework.org/schema/beans/spring-beans-2.0.xsd       
http://www.springframework.org/schema/jee      
http://www.springframework.org/schema/jee/spring-jee-2.0.xsd&quot;&gt;        
    &lt;jee:jndi-lookup id=&quot;dataSource&quot; jndi-name=&quot; java:comp/env/jdbc/orclight&quot;/&gt;        
&lt;/beans&gt; 
</code></pre>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://jike-leisong.github.io//tag/shu-ju-yuan" class="tag">
                    数据源
                  </a>
                
                  <a href="https://jike-leisong.github.io//tag/mian-shi-ti" class="tag">
                    面试题
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://jike-leisong.github.io//post/SQL注入">
                  <h3 class="post-title">
                    SQL注入
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
